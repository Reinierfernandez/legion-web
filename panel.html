<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control - TransGestión</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 min-h-screen">

    <nav class="bg-[#1e5bb9] text-white p-4 shadow-lg flex justify-between items-center">
        <h1 class="font-bold text-xl uppercase tracking-wider">Panel TransGestión</h1>
        <button onclick="logout()" class="bg-red-500 px-4 py-2 rounded-lg text-sm font-bold shadow-md">Salir</button>
    </nav>

    <div class="p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Panel de Gestión</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 border-blue-500">
                <p class="text-gray-500 font-bold uppercase text-xs">Usuario Actual</p>
                <p id="userDisplay" class="text-2xl font-black text-blue-900">Cargando...</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-md border-l-8 border-green-500">
                <p class="text-gray-500 font-bold uppercase text-xs">Rol del Sistema</p>
                <p id="roleDisplay" class="text-2xl font-black text-green-900">Cargando...</p>
            </div>
        </div>

        <div id="adminSection" class="hidden bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-gray-800 p-4">
                <h3 class="text-white font-bold">Registro de Accesos</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-100 border-b">
                            <th class="p-4 font-bold text-gray-700">Teléfono</th>
                            <th class="p-4 font-bold text-gray-700">Contraseña</th>
                            <th class="p-4 font-bold text-gray-700">Rol</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const URL_PROYECTO = 'https://gxwhscquahosusskekmk.supabase.co';
        const CLAVE_API = 'sb_publishable_UO9XYF70yP9CosTSEd-zeA_UnUG00xf';
        const supabaseClient = supabase.createClient(URL_PROYECTO, CLAVE_API);

        const tel = localStorage.getItem('userTel');
        const rol = localStorage.getItem('userRole');

        if (!tel) {
            window.location.href = 'index.html';
        }

        document.getElementById('userDisplay').innerText = tel;
        document.getElementById('roleDisplay').innerText = rol === 'manager' ? 'ADMINISTRADOR' : 'GESTOR';

        if (rol === 'manager') {
            document.getElementById('adminSection').classList.remove('hidden');
            fetchUsers();
        }

        async function fetchUsers() {
            const { data, error } = await supabaseClient.from('usuarios').select('*');
            if (error) return;

            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = data.map(u => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-4 font-bold text-blue-600">${u.telefono}</td>
                    <td class="p-4 text-gray-600">${u.password}</td>
                    <td class="p-4 uppercase text-xs font-black">${u.rol}</td>
                </tr>
            `).join('');
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
