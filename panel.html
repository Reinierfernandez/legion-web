‎<!DOCTYPE html>
‎<html lang="es">
‎<head>
‎    <meta charset="UTF-8">
‎    <meta name="viewport" content="width=device-width, initial-scale=1.0">
‎    <title>TransGestión - Panel Profesional</title>
‎    <script src="https://cdn.tailwindcss.com"></script>
‎    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
‎    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
‎    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
‎    <style>
‎        .sidebar { transition: all 0.3s; width: 0; overflow: hidden; }
‎        .sidebar.open { width: 260px; }
‎        ::-webkit-scrollbar { width: 5px; }
‎        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
‎    </style>
‎</head>
‎<body class="bg-gray-100 min-h-screen flex">
‎
‎    <div id="sidebar" class="sidebar fixed lg:relative z-50 h-screen bg-gray-900 text-white flex flex-col shadow-2xl">
‎        <div class="p-5 text-xl font-black border-b border-gray-800 flex justify-between items-center">
‎            <span>TRANSGESTIÓN</span>
‎            <button onclick="toggleMenu()" class="lg:hidden text-white"><i class="fas fa-times"></i></button>
‎        </div>
‎        <nav class="flex-1 overflow-y-auto p-4 space-y-2 text-sm">
‎            <a href="javascript:void(0)" onclick="mostrarSeccion('dashboard')" class="flex items-center p-3 hover:bg-blue-600 rounded-lg transition-colors"><i class="fas fa-chart-line mr-3"></i> Panel de Control</a>
‎            <a href="javascript:void(0)" onclick="mostrarSeccion('crear-viaje')" class="flex items-center p-3 hover:bg-blue-600 rounded-lg transition-colors"><i class="fas fa-plus-circle mr-3"></i> Crear Viajes</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-route mr-3"></i> Mis Viajes</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-users mr-3"></i> Choferes</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-filter mr-3"></i> Filtrar Viajes</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-clock mr-3"></i> Pagos Pendientes</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-check-double mr-3"></i> Pagos por Aprobar</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-credit-card mr-3"></i> Tarjetas</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-exchange-alt mr-3"></i> Transferencias</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-handshake mr-3"></i> Colaboración</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-user-cog mr-3"></i> Usuarios</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-wallet mr-3"></i> Economía</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-address-book mr-3"></i> Clientes</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-cog mr-3"></i> Configuración</a>
‎            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fab fa-whatsapp mr-3"></i> API WhatsApp</a>
‎        </nav>
‎        <button onclick="logout()" class="p-4 bg-red-900 hover:bg-red-700 text-xs font-bold uppercase tracking-widest">Cerrar Sesión</button>
‎    </div>
‎
‎    <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
‎        <header class="bg-white shadow-sm p-4 flex items-center justify-between">
‎            <button onclick="toggleMenu()" class="text-gray-600 text-2xl"><i class="fas fa-bars"></i></button>
‎            <div class="flex items-center space-x-4">
‎                <span id="userRoleBadge" class="bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-full uppercase">Cargando...</span>
‎                <span id="userTel" class="text-gray-600 font-medium"></span>
‎            </div>
‎        </header>
‎
‎        <main id="main-content" class="p-4 lg:p-8 overflow-y-auto">
‎            
‎            <div id="section-dashboard" class="space-y-8">
‎                <h2 class="text-3xl font-black text-gray-800">Panel de Control</h2>
‎                <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-200">
‎                    <h3 class="text-lg font-bold text-gray-700 mb-4 italic">Viajes Diarios</h3>
‎                    <div class="h-64"><canvas id="viajesChart"></canvas></div>
‎                </div>
‎                <div class="bg-white rounded-3xl shadow-sm border border-gray-200 overflow-hidden text-sm">
‎                    <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
‎                        <h3 class="text-lg font-bold text-gray-700 italic">Viajes Recientes</h3>
‎                    </div>
‎                    <table class="w-full text-left">
‎                        <thead class="bg-gray-50 text-gray-400 uppercase text-[10px] tracking-widest">
‎                            <tr><th class="p-4">Choferes</th><th class="p-4">Precio</th><th class="p-4">Origen</th></tr>
‎                        </thead>
‎                        <tbody id="viajesTableBody">
‎                            <tr class="border-b"><td class="p-4 font-bold">Juan Pérez</td><td class="p-4 text-green-600">$150</td><td class="p-4">Habana</td></tr>
‎                        </tbody>
‎                    </table>
‎                </div>
‎            </div>
‎
‎            <div id="section-crear-viaje" class="hidden max-w-4xl mx-auto bg-white p-6 rounded-3xl shadow-lg border border-gray-200">
‎                <h2 class="text-2xl font-black text-gray-800 mb-6 flex items-center"><i class="fas fa-plus-circle text-blue-600 mr-3"></i> Elaborar Viaje</h2>
‎                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
‎                    <div>
‎                        <label class="block text-sm font-bold text-gray-700 mb-1">Colaboración</label>
‎                        <select id="v-colab" class="w-full p-3 bg-gray-50 border rounded-xl outline-none"><option>Ninguna</option><option>Agencia A</option></select>
‎                    </div>
‎                    <div>
‎                        <label class="block text-sm font-bold text-gray-700 mb-1">Chofer (Teléfono)</label>
‎                        <div class="flex space-x-2">
‎                            <input id="v-chofer-tel" type="tel" placeholder="55555555" class="flex-1 p-3 bg-gray-50 border rounded-xl">
‎                            <button onclick="buscarChofer()" class="bg-blue-600 text-white px-4 rounded-xl"><i class="fas fa-search"></i></button>
‎                        </div>
‎                        <div id="chofer-info" class="mt-2 p-3 bg-blue-50 rounded-xl hidden text-xs">
‎                            <p id="info-nombre" class="font-bold text-gray-700"></p>
‎                            <p id="info-fondo" class="text-green-600 font-bold"></p>
‎                        </div>
‎                    </div>
‎                    <div class="grid grid-cols-2 gap-4">
‎                        <div><label class="block text-sm font-bold text-gray-700 mb-1">Cliente (Tel)</label><input id="v-cliente" type="tel" class="w-full p-3 bg-gray-50 border rounded-xl"></div>
‎                        <div><label class="block text-sm font-bold text-gray-700 mb-1">Pax</label><input id="v-pax" type="number" class="w-full p-3 bg-gray-50 border rounded-xl text-center"></div>
‎                    </div>
‎                    <div>
‎                        <label class="block text-sm font-bold text-gray-700 mb-1">Precio ($)</label>
‎                        <input id="v-precio" type="number" class="w-full p-3 bg-blue-50 border-blue-200 border rounded-xl text-lg font-bold text-blue-700">
‎                        <div class="mt-2 p-3 bg-gray-100 rounded-xl grid grid-cols-2 gap-2">
‎                            <input id="calc-dist" type="number" placeholder="Km" class="p-2 text-xs border rounded-lg">
‎                            <input id="calc-tarifa" type="number" placeholder="Tarifa" class="p-2 text-xs border rounded-lg">
‎                            <button onclick="calcularPrecio()" class="col-span-2 bg-gray-700 text-white text-[10px] py-2 rounded-lg font-bold">CALCULAR PRECIO</button>
‎                        </div>
‎                    </div>
‎                    <div class="md:col-span-2">
‎                        <label class="block text-sm font-bold text-gray-700 mb-1">Origen</label>
‎                        <input id="v-origen" type="text" class="w-full p-3 bg-gray-50 border rounded-xl mb-2">
‎                        <div id="contenedor-paradas" class="space-y-2 mb-2"></div>
‎                        <button onclick="añadirParada()" class="text-blue-600 text-xs font-bold"><i class="fas fa-plus-circle mr-1"></i> Añadir Parada Intermedia</button>
‎                    </div>
‎                    <div><label class="block text-sm font-bold text-gray-700 mb-1">Destino</label><input id="v-destino" type="text" class="w-full p-3 bg-gray-50 border rounded-xl"></div>
‎                    <div><label class="block text-sm font-bold text-gray-700 mb-1">Grupo WhatsApp</label><input id="v-grupo" type="text" class="w-full p-3 bg-gray-50 border rounded-xl"></div>
‎                    <div class="md:col-span-2 grid grid-cols-2 gap-3 py-2 text-xs font-bold">
‎                        <label class="flex items-center space-x-2"><input type="checkbox" id="v-transf"> <span>Transferencia</span></label>
‎                        <label class="flex items-center space-x-2"><input type="checkbox" id="v-precio-cli"> <span>Precio Cliente</span></label>
‎                        <label class="flex items-center space-x-2"><input type="checkbox" id="v-aire"> <span>Aire Acond.</span></label>
‎                        <label class="flex items-center space-x-2"><input type="checkbox" id="v-regreso"> <span>Ida y Vuelta</span></label>
‎                    </div>
‎                    <div class="md:col-span-2 border-t pt-4">
‎                        <label class="flex items-center space-x-2 text-sm font-black cursor-pointer mb-3">
‎                            <input type="checkbox" id="v-es-reserva" onchange="toggleReserva()" class="w-5 h-5"> <span>VIAJE RESERVADO</span>
‎                        </label>
‎                        <div id="zona-reserva" class="hidden grid grid-cols-2 gap-4"><input id="v-fecha" type="date" class="p-3 bg-blue-50 border rounded-xl"><input id="v-hora" type="time" class="p-3 bg-blue-50 border rounded-xl"></div>
‎                    </div>
‎                    <div class="md:col-span-2"><label class="block text-sm font-bold text-gray-700 mb-1">Observaciones</label><textarea id="v-obs" rows="2" class="w-full p-3 bg-gray-50 border rounded-xl"></textarea></div>
‎                </div>
‎                <div class="mt-8 grid grid-cols-2 gap-4">
‎                    <button onclick="generarPlanillas()" class="bg-gray-800 text-white p-4 rounded-2xl font-black shadow-lg">PLANILLA</button>
‎                    <button onclick="alert('Guardado con éxito (Próximamente en base de datos)')" class="bg-blue-600 text-white p-4 rounded-2xl font-black shadow-lg">CREAR VIAJE</button>
‎                </div>
‎            </div>
‎        </main>
‎    </div>
‎
‎    <div id="modal-planillas" class="fixed inset-0 bg-black/80 hidden z-[100] p-4 flex items-center justify-center overflow-y-auto">
‎        <div class="bg-white w-full max-w-lg rounded-3xl p-6 relative">
‎            <button onclick="cerrarModal()" class="absolute top-4 right-4 text-gray-400 text-2xl">&times;</button>
‎            <div class="space-y-6">
‎                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
‎                    <h4 class="text-blue-700 font-bold mb-2">Planilla Chofer</h4>
‎                    <pre id="txt-chofer" class="text-[10px] whitespace-pre-wrap font-mono p-2 bg-white rounded border"></pre>
‎                    <button onclick="enviarWhatsApp('chofer')" class="w-full mt-2 bg-green-500 text-white py-2 rounded-lg text-sm font-bold">Enviar WhatsApp</button>
‎                </div>
‎                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
‎                    <h4 class="text-green-700 font-bold mb-2">Planilla Cliente</h4>
‎                    <pre id="txt-cliente" class="text-[10px] whitespace-pre-wrap font-mono p-2 bg-white rounded border"></pre>
‎                    <button onclick="enviarWhatsApp('cliente')" class="w-full mt-2 bg-green-600 text-white py-2 rounded-lg text-sm font-bold">Enviar WhatsApp</button>
‎                </div>
‎            </div>
‎        </div>
‎    </div>
‎
‎    <script>
‎        // CONFIGURACIÓN INICIAL
‎        const tel = localStorage.getItem('userTel');
‎        const rol = localStorage.getItem('userRole');
‎        if (!tel) window.location.href = 'index.html';
‎        document.getElementById('userTel').innerText = tel;
‎        document.getElementById('userRoleBadge').innerText = rol === 'manager' ? 'Administrador' : 'Gestor';
‎
‎        function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }
‎        if(window.innerWidth > 1024) toggleMenu();
‎
‎        function mostrarSeccion(id) {
‎            document.getElementById('section-dashboard').classList.add('hidden');
‎            document.getElementById('section-crear-viaje').classList.add('hidden');
‎            document.getElementById('section-' + id).classList.remove('hidden');
‎            if(window.innerWidth < 1024) toggleMenu();
‎        }
‎
‎        // LÓGICA CREAR VIAJE
‎        function añadirParada() {
‎            const input = document.createElement('input');
‎            input.placeholder = "Parada intermedia...";
‎            input.className = "w-full p-3 bg-yellow-50 border border-yellow-200 rounded-xl mb-2 text-sm";
‎            document.getElementById('contenedor-paradas').appendChild(input);
‎        }
‎
‎        function buscarChofer() {
‎            const num = document.getElementById('v-chofer-tel').value;
‎            if(num) {
‎                document.getElementById('chofer-info').classList.remove('hidden');
‎                document.getElementById('info-nombre').innerText = "Nombre: Chofer de prueba";
‎                document.getElementById('info-fondo').innerText = "Fondo Actual: $500.00";
‎            }
‎        }
‎
‎        function calcularPrecio() {
‎            const km = document.getElementById('calc-dist').value;
‎            const t = document.getElementById('calc-tarifa').value;
‎            if(km && t) document.getElementById('v-precio').value = km * t;
‎        }
‎
‎        function toggleReserva() {
‎            document.getElementById('zona-reserva').classList.toggle('hidden', !document.getElementById('v-es-reserva').checked);
‎        }
‎
‎        function generarPlanillas() {
‎            const p = document.getElementById('v-precio').value;
‎            const c = document.getElementById('v-cliente').value;
‎            const o = document.getElementById('v-origen').value;
‎            const d = document.getElementById('v-destino').value;
‎            const px = document.getElementById('v-pax').value || 1;
‎
‎            const pCh = `*DATOS DEL VIAJE*\nPrecio: ${p}\nCliente: ${c}\nOrigen: ${o}\nDestino: ${d}\nPax: ${px}\nFondo Actual: $500\n\n⚠️ IMPORTANTE ⚠️\n• 15 min máx. llegada.\n• 15 min cortesía espera. (Extra: 25 cup/min)\n• Tarde: descuento 50%.`;
‎            const pCl = `*Taxi En Camino*\nPrecio: ${p}\nChofer: Prueba\nAuto: Estándar\n\n⚠️ *IMPORTANTE* ⚠️\n• Parada extra recalcula costo.\n• 10 min cortesía. (Extra: 25 cup/min).\n• Cancelar en origen: paga 50%.`;
‎
‎            document.getElementById('txt-chofer').innerText = pCh;
‎            document.getElementById('txt-cliente').innerText = pCl;
‎            document.getElementById('modal-planillas').classList.remove('hidden');
‎        }
‎
‎        function enviarWhatsApp(tipo) {
‎            const num = tipo === 'chofer' ? document.getElementById('v-chofer-tel').value : document.getElementById('v-cliente').value;
‎            const msg = encodeURIComponent(tipo === 'chofer' ? document.getElementById('txt-chofer').innerText : document.getElementById('txt-cliente').innerText);
‎            window.open(`https://wa.me/53${num}?text=${msg}`, '_blank');
‎        }
‎
‎        function cerrarModal() { document.getElementById('modal-planillas').classList.add('hidden'); }
‎
‎        function logout() { localStorage.clear(); window.location.href = 'index.html'; }
‎
‎        // GRÁFICA INICIAL
‎        const ctx = document.getElementById('viajesChart').getContext('2d');
‎        new Chart(ctx, {
‎            type: 'line',
‎            data: { labels: ['Lun','Mar','Mie','Jue','Vie','Sab','Dom'], datasets: [{ label: 'Viajes', data: [5, 10, 8, 15, 6, 20, 12], borderColor: '#1e5bb9', tension: 0.4 }] },
‎            options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
‎        });
‎    </script>
‎</body>
‎</html>
‎
