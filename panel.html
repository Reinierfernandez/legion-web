<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransGestión - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .sidebar { transition: all 0.3s; width: 0; overflow: hidden; }
        .sidebar.open { width: 260px; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex">

    <div id="sidebar" class="sidebar fixed lg:relative z-50 h-screen bg-gray-900 text-white flex flex-col shadow-2xl">
        <div class="p-5 text-xl font-black border-b border-gray-800 flex justify-between items-center">
            <span>TRANSGESTIÓN</span>
            <button onclick="toggleMenu()" class="lg:hidden text-white"><i class="fas fa-times"></i></button>
        </div>
        <nav class="flex-1 overflow-y-auto p-4 space-y-2 text-sm">
            <a href="#" class="flex items-center p-3 bg-blue-600 rounded-lg"><i class="fas fa-chart-line mr-3"></i> Panel de Control</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-plus-circle mr-3"></i> Crear Viajes</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-route mr-3"></i> Mis Viajes</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-users mr-3"></i> Choferes</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-filter mr-3"></i> Filtrar Viajes</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-clock mr-3"></i> Pagos Pendientes</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-check-double mr-3"></i> Pagos por Aprobar</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-credit-card mr-3"></i> Tarjetas</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-exchange-alt mr-3"></i> Transferencias</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-handshake mr-3"></i> Colaboración</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-user-cog mr-3"></i> Usuarios</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-wallet mr-3"></i> Economía</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-address-book mr-3"></i> Clientes</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fas fa-cog mr-3"></i> Configuración</a>
            <a href="#" class="flex items-center p-3 hover:bg-gray-800 rounded-lg text-gray-400"><i class="fab fa-whatsapp mr-3"></i> API WhatsApp</a>
        </nav>
        <button onclick="logout()" class="p-4 bg-red-900 hover:bg-red-700 text-xs font-bold uppercase tracking-widest">Cerrar Sesión</button>
    </div>

    <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
        <header class="bg-white shadow-sm p-4 flex items-center justify-between">
            <button onclick="toggleMenu()" class="text-gray-600 text-2xl"><i class="fas fa-bars"></i></button>
            <div class="flex items-center space-x-4">
                <span id="userRoleBadge" class="bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-full uppercase">Cargando...</span>
                <span id="userTel" class="text-gray-600 font-medium"></span>
            </div>
        </header>

        <main class="p-4 lg:p-8 overflow-y-auto">
            <div class="max-w-6xl mx-auto space-y-8">
                
                <h2 class="text-3xl font-black text-gray-800">Panel de Control</h2>

                <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-200">
                    <h3 class="text-lg font-bold text-gray-700 mb-4 italic">Viajes Diarios</h3>
                    <div class="h-64">
                        <canvas id="viajesChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-3xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-gray-700 italic">Viajes Recientes</h3>
                        <span class="text-xs font-bold text-blue-500 uppercase tracking-widest">Últimos 5 registros</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-400 text-xs uppercase tracking-widest">
                                    <th class="p-4 font-bold">Choferes</th>
                                    <th class="p-4 font-bold">Precio</th>
                                    <th class="p-4 font-bold">Origen</th>
                                </tr>
                            </thead>
                            <tbody id="viajesTableBody" class="text-gray-700 font-medium">
                                </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // Configuración Sidebar
        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        // Abrir por defecto en PC
        if(window.innerWidth > 1024) toggleMenu();

        // Datos del usuario
        const tel = localStorage.getItem('userTel');
        const rol = localStorage.getItem('userRole');
        if (!tel) window.location.href = 'index.html';
        document.getElementById('userTel').innerText = tel;
        document.getElementById('userRoleBadge').innerText = rol === 'manager' ? 'Administrador' : 'Gestor';

        // Muestra de datos (Simulados para que veas el diseño)
        const mockViajes = [
            { chofer: "Juan Pérez", precio: "$150.00", origen: "Habana" },
            { chofer: "Luis Gómez", precio: "$200.00", origen: "Matanzas" },
            { chofer: "Pedro Ruiz", precio: "$120.00", origen: "Cienfuegos" },
            { chofer: "Carlos Más", precio: "$300.00", origen: "Santiago" },
            { chofer: "Jose Vila", precio: "$180.00", origen: "Habana" }
        ];

        const tbody = document.getElementById('viajesTableBody');
        tbody.innerHTML = mockViajes.map(v => `
            <tr class="border-b border-gray-50 hover:bg-gray-50 transition-colors">
                <td class="p-4"><div class="flex items-center"><i class="fas fa-user-circle text-blue-500 mr-2"></i> ${v.chofer}</div></td>
                <td class="p-4 font-bold text-green-600">${v.precio}</td>
                <td class="p-4"><span class="bg-gray-100 px-3 py-1 rounded-full text-xs">${v.origen}</span></td>
            </tr>
        `).join('');

        // Gráfica de Viajes Diarios
        const ctx = document.getElementById('viajesChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
                datasets: [{
                    label: 'Cantidad de Viajes',
                    data: [12, 19, 3, 5, 2, 3, 10], // Estos datos vendrán de Supabase después
                    borderColor: '#1e5bb9',
                    backgroundColor: 'rgba(30, 91, 185, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true } }
            }
        });

        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
